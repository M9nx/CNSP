





### Types of Malware Analysis

1. Static Analysis – Examining the malware without running it.
2. Dynamic Analysis – Running the malware in a controlled environment.
3. Code Analysis – Reverse-engineering the malware’s source code.
4. Memory Analysis – Investigating memory dumps for malicious activity.

---

## 1. Static Malware Analysis (Without Execution)

Static analysis is the first step and provides a high-level understanding of the malware file.

### A. Identifying the Malware File Type

- Use `file` (Linux) or `pefile` (Windows) to determine the executable type.
    
    ```sh
    file malware.exe
    ```
    
- Common malware file types:
    - `.exe`, `.dll` (Windows)
    - `.apk` (Android)
    - `.js`, `.vbs`, `.bat` (Script-based malware)

### B. Computing Hashes for Threat Intelligence

- Check the malware’s hash against VirusTotal:
    
    ```sh
    sha256sum malware.exe
    ```
    
- Online platforms for hash lookup:
    - VirusTotal
    - Hybrid Analysis
    - Malware Bazaar

### C. Extracting Strings

- Search for suspicious strings in the binary:
    
    ```sh
    strings malware.exe | more
    ```
    
- Look for:
    - Domains & IPs (e.g., `hacker-site.com`)
    - API Calls (`CreateProcess`, `WinExec`)
    - Hardcoded commands (`cmd.exe`, `powershell.exe`)

### D. Analyzing PE Headers and Imports

- Use `PEview`, `PEStudio`, or `objdump`:
    
    ```sh
    objdump -x malware.exe
    ```
    
- Focus on API calls related to:
    - Process manipulation (`CreateProcess`, `OpenProcess`)
    - File system access (`ReadFile`, `WriteFile`)
    - Network activity (`InternetOpenURL`, `send`)

### E. Identifying Packing & Obfuscation

- Malware often uses packers (UPX, Themida) to hide its real code.
    
    ```sh
    upx -d malware.exe
    ```
    
- Use `Detect It Easy (DIE)` or `PEiD` to check for packing techniques.

---

## 2. Dynamic Malware Analysis (Behavioral Analysis)

Dynamic analysis involves running the malware in a sandboxed environment to observe its actions.

### A. Setting Up a Safe Environment

- Use Virtual Machines (VMware, VirtualBox).
- Isolate the network or use a fake internet simulation tool like FakeNet-NG.
- Essential tools:
    - ProcMon – Tracks file, registry, and process changes.
    - Wireshark – Monitors network traffic.
    - Regshot – Compares system registry changes before and after execution.

### B. Running the Malware & Monitoring Changes

1. Execute the malware inside the sandbox.
2. Observe process creation (`tasklist` or `Process Explorer`).
3. Identify new files, registry changes, and network connections.

### C. Monitoring Network Activity

- Capture outgoing network requests:
    
    ```sh
    tcpdump -i eth0 -w capture.pcap
    ```
    
- Indicators of compromise (IOCs):
    - DNS Queries – Does it contact suspicious domains?
    - HTTP Requests – Is it downloading additional payloads?
    - C2 Communication – Is it connecting to a remote command-and-control server?

---

## 3. Advanced Code Analysis (Reverse Engineering & Debugging)

For deeper insights, reverse-engineer the malware using tools like IDA Pro, Ghidra, or Radare2.

### A. Disassembling & Debugging

- Use `IDA Pro` or `Ghidra` to analyze malware instructions.
- Debug with `x64dbg` or `OllyDbg` to observe runtime execution.

### B. Extracting Embedded Payloads

- Some malware contains secondary payloads. Use `binwalk` to extract:
    
    ```sh
    binwalk -e malware.exe
    ```
    
- Look for `.dll` or `.exe` payloads that could be additional malware components.

### C. Decrypting Encrypted Malware Strings

- Many malware strains encrypt hardcoded strings (e.g., C2 URLs).
- Use `CyberChef` or in-memory analysis tools to extract decrypted values.

---

## 4. Memory Analysis (Forensic Investigation)

Memory analysis helps investigate live malware infections on compromised systems.

### A. Using Volatility for Memory Analysis

- Extract a memory dump from an infected system:
    
    ```sh
    winpmem.exe --output memory.dump
    ```
    
- Analyze it with Volatility:
    
    ```sh
    volatility -f memory.dump --profile=Win10x64 pstree
    ```
    
- Key checks:
    - Suspicious processes (`svchost.exe` in the wrong directory)
    - Network connections (`netscan`)
    - Injected DLLs (`malfind`)

---

## 5. Indicators of Compromise (IOCs) & Threat Intelligence

After analyzing malware, collect and report IOCs.

### A. Key IOCs

✅ File Hashes (MD5, SHA256)  
✅ Malicious Domains & IPs  
✅ Registry Modifications (`Run` keys, scheduled tasks)  
✅ Persistence Mechanisms (Startup scripts, scheduled tasks)

### B. Submitting to Threat Intelligence Platforms

- VirusTotal – Upload and check detection rates.
- Hybrid Analysis – Detailed malware reports.
- ThreatCrowd – Investigate related domains and IPs.

---

## 6. Reporting & Mitigation

### A. Creating a Malware Analysis Report

A well-structured report should include:

- Executive Summary (High-level findings)
- Technical Analysis (Static, dynamic, and code review)
- IOCs (Hashes, domains, file locations)
- Mitigation Recommendations

### B. Mitigation Strategies

- Block malicious domains & IPs in firewalls and IDS.
- Update endpoint security rules (YARA, Snort, Suricata).
- Educate users on phishing and malware infection vectors.

---

## 7. Key Takeaways for CNSP Exam

- Understand the Malware Lifecycle (delivery, execution, persistence, exfiltration).
- Know the Tools for Analysis (Static: `strings`, `PEStudio` | Dynamic: `ProcMon`, `Wireshark`).
- Be Familiar with Indicators of Compromise (IOCs) (File hashes, C2 domains, registry changes).
- Master Memory Forensics (`Volatility` for analyzing infected memory dumps).
- Report and Mitigate (Use Threat Intelligence platforms and update detection rules).

---
